renv::init()
load("~/McKay/BAP_Project/R/rData/sheets.rda")
View(faire.wt.ss)
library(magrittr)
library(ggplot2)
library(GenomicRanges)
source('~/NystLib/R/peakUtils.R')
sampleSheet <- read.csv('sheets/sampleSheet.tsv', header = T, sep = '\t') %>%
dplyr::mutate(fraction = stringr::str_split_fixed(sample,'-',n=5)[,5],
ab = stringr::str_split_fixed(sample,'-',n=5)[,4],
genotype = stringr::str_split_fixed(sample,'-',n=5)[,1], .before = 1,
grp = paste(genotype,ab,fraction,rep, sep = '.'))
sampleSheet
peaks <- getPeakData(sampleSheet %>% dplyr::filter(fraction == 'sup'), by = 'grp', narrowPeak_colname = 'peak_allFrags')
library(magrittr)
library(ggplot2)
library(GenomicRanges)
source('~/NystLib/R/peakUtils.R')
sampleSheet <- read.csv('sheets/sampleSheet.tsv', header = T, sep = '\t') %>%
dplyr::mutate(fraction = stringr::str_split_fixed(sample,'-',n=5)[,5],
ab = stringr::str_split_fixed(sample,'-',n=5)[,4],
genotype = stringr::str_split_fixed(sample,'-',n=5)[,1], .before = 1,
grp = paste(genotype,ab,fraction,rep, sep = '.'))
sampleSheet
peaks <- getPeakData(sampleSheet %>% dplyr::filter(fraction == 'sup'), by = 'grp', narrowPeak_colname = 'peak_allFrags')
install.packages('readr')
peaks <- getPeakData(sampleSheet %>% dplyr::filter(fraction == 'sup'), by = 'grp', narrowPeak_colname = 'peak_allFrags')
pg <- peaks %>%
GRanges() %>%
+ 500 %>%
split(., mcols(.)$grp)
pgr <- lapply(pg, function(x) {x %>% reduce()}) %>%
GRangesList()
macs.ex <- pgr %>%
unlist() %>%
reduce() %>%
data.frame() %>%
dplyr::mutate(peak = 1:nrow(.),
yw.igg.1 = ifelse(GRanges(.) %over% pgr$yw.IgG.sup.Rep1, T, F),
yw.igg.2 = ifelse(GRanges(.) %over% pgr$yw.IgG.sup.Rep2, T, F),
or.igg.1 = ifelse(GRanges(.) %over% pgr$OR.IgG.sup.Rep1, T, F),
aFlag.1 = ifelse(GRanges(.) %over% pgr$yw.aFlag.sup.Rep1, T, F),
aFlag.2 = ifelse(GRanges(.) %over% pgr$yw.aFlag.sup.Rep2, T, F),
aGFP.1 = ifelse(GRanges(.) %over% pgr$yw.aGFP.sup.Rep1, T, F),
aGFP.2 = ifelse(GRanges(.) %over% pgr$yw.aGFP.sup.Rep2, T, F),
shared = ifelse(yw.igg.1 &
yw.igg.2 &
or.igg.1 &
aFlag.1 &
aFlag.2 &
aGFP.1 &
aGFP.2, T, F)) %>%
dplyr::filter(shared & )
macs.ex <- pgr %>%
unlist() %>%
reduce() %>%
data.frame() %>%
dplyr::mutate(peak = 1:nrow(.),
yw.igg.1 = ifelse(GRanges(.) %over% pgr$yw.IgG.sup.Rep1, T, F),
yw.igg.2 = ifelse(GRanges(.) %over% pgr$yw.IgG.sup.Rep2, T, F),
or.igg.1 = ifelse(GRanges(.) %over% pgr$OR.IgG.sup.Rep1, T, F),
aFlag.1 = ifelse(GRanges(.) %over% pgr$yw.aFlag.sup.Rep1, T, F),
aFlag.2 = ifelse(GRanges(.) %over% pgr$yw.aFlag.sup.Rep2, T, F),
aGFP.1 = ifelse(GRanges(.) %over% pgr$yw.aGFP.sup.Rep1, T, F),
aGFP.2 = ifelse(GRanges(.) %over% pgr$yw.aGFP.sup.Rep2, T, F),
shared = ifelse(yw.igg.1 &
yw.igg.2 &
or.igg.1 &
aFlag.1 &
aFlag.2 &
aGFP.1 &
aGFP.2, T, F)) %>%
dplyr::filter(shared)
macs.ex
macs.ex <- pgr %>%
unlist() %>%
reduce() %>%
data.frame() %>%
dplyr::mutate(peak = 1:nrow(.),
yw.igg.1 = ifelse(GRanges(.) %over% pgr$yw.IgG.sup.Rep1, T, F),
yw.igg.2 = ifelse(GRanges(.) %over% pgr$yw.IgG.sup.Rep2, T, F),
or.igg.1 = ifelse(GRanges(.) %over% pgr$OR.IgG.sup.Rep1, T, F),
aFlag.1 = ifelse(GRanges(.) %over% pgr$yw.aFlag.sup.Rep1, T, F),
aFlag.2 = ifelse(GRanges(.) %over% pgr$yw.aFlag.sup.Rep2, T, F),
aGFP.1 = ifelse(GRanges(.) %over% pgr$yw.aGFP.sup.Rep1, T, F),
aGFP.2 = ifelse(GRanges(.) %over% pgr$yw.aGFP.sup.Rep2, T, F),
shared = ifelse(yw.igg.1 &
yw.igg.2 &
or.igg.1 &
aFlag.1 &
aFlag.2 &
aGFP.1 &
aGFP.2, T, F)) %>%
dplyr::filter(shared & seqnames != 'chrM')
macs.ex
