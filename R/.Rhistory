padding = unit(0, 'mm')),
groups = anno_block(gp = gpar(fill = 2:4), show_name = F)),
row_title  = NULL,
use_raster = F) +
EnrichedHeatmap(faire.24h.mat,
pos_line = F,
axis_name = c(-2, 0, 2),
col = col_fun,
column_title = '24h',
top_annotation = HeatmapAnnotation(lines = anno_enriched(gp = gpar(col = 2:4), ylim = c(0,6))),
row_title  = NULL,
show_heatmap_legend = F,
use_raster = F)
png('rPlots/3E.png', width = 4, height = 5, units = 'in', res = 300)
ComplexHeatmap::draw(hm, annotation_legend_list = c(lgd), row_split = groups, merge_legend = T, heatmap_legend_side = 'left', )
dev.off()
peaks %>%
dplyr::filter(assay == 'faire' & experiment == 'WT FAIRE Wing Timecourse') %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h | !WT.3LW & !WT.6h & WT.24h & !WT.44h) %>%
#  dplyr::filter(WT.3LW | WT.24h) %>%
dplyr::group_by(faireCat.3LW_24h, osa.cnr, yw.cnr) %>%
dplyr::count() %>%
na.omit() %>%
dplyr::mutate(Osa.Bound = ifelse(osa.cnr & !yw.cnr, T, F)) %>%
dplyr::ungroup() %>%
dplyr::select(faireCat.3LW_24h, Osa.Bound, n) %>%
reshape2::melt(id = c("Osa.Bound","n"), variable.name = 'stage', value.name = 'change') %>%
dplyr::group_by(stage, change, Osa.Bound) %>%
dplyr::summarise(peaks = sum(n)) %>%
dplyr::mutate(fraction = peaks / sum(peaks),
change = factor(change, levels = c('static','opening','closing'))) %>%
dplyr::mutate(per = paste0(round(100*fraction, digits = 1),'%')) %>%
plot.frac()
#TODO - combine fraction barplots and heatmaps into single figure - cowplots? grid?
fairePeaks.wt.test <- fairePeaks.wt %>%
data.frame() %>%
dplyr::filter(anno.new %in% c('Distal Intergenic','Intron')) %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h | !WT.3LW & !WT.6h & WT.24h & !WT.44h) %>%
GRanges()
faire.3lw.mat <- normalizeToMatrix(bws$wt_3LW, fairePeaks.wt.test, value_column = 'score', keep = c(0.01,0.99), extend = 2000)
faire.24h.mat <- normalizeToMatrix(bws$wt_24h, fairePeaks.wt.test, value_column = 'score', keep = c(0.01,0.99), extend = 2000)
common_min = min(c(faire.3lw.mat, faire.24h.mat))
common_max = max(c(faire.3lw.mat, faire.24h.mat))
col_fun = circlize::colorRamp2(seq(common_min, common_max, length.out = 6), viridis.hex)
faire.count <- fairePeaks.wt.test %>%
data.frame() %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h | !WT.3LW & !WT.6h & WT.24h & !WT.44h) %>%
dplyr::group_by(faireCat.3LW_24h) %>%
dplyr::count() %>%
dplyr::mutate(n = as.character(n)) %>%
.$n
names(faire.count) <- c('closing','opening','static')
groups <- fairePeaks.wt.test %>%
data.frame() %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h | !WT.3LW & !WT.6h & WT.24h & !WT.44h) %>%
.$faireCat.3LW_24h
lgd = Legend(at = c("closing", "opening", "static"), legend_gp = gpar(fill = 2:4))
hm <- EnrichedHeatmap(faire.3lw.mat,
pos_line = F,
axis_name = c(-2, 0, 2),
col = col_fun,
column_title = '3LW',
top_annotation = HeatmapAnnotation(lines = anno_enriched(gp = gpar(col = 2:4),
ylim = c(0,6),
axis_param = list(side = 'left'))),
name = 'FAIRE zScore',
left_annotation = rowAnnotation(textbox = anno_textbox(align_to = groups,
as.list(faire.count),
side = 'left',
background_gp = gpar(fill = NA, col = NA),
gp = gpar(col = 'black'),
padding = unit(0, 'mm')),
groups = anno_block(gp = gpar(fill = 2:4), show_name = F)),
row_title  = NULL,
use_raster = F) +
EnrichedHeatmap(faire.24h.mat,
pos_line = F,
axis_name = c(-2, 0, 2),
col = col_fun,
column_title = '24h',
top_annotation = HeatmapAnnotation(lines = anno_enriched(gp = gpar(col = 2:4), ylim = c(0,6))),
row_title  = NULL,
show_heatmap_legend = F,
use_raster = F)
png('rPlots/3E.png', width = 4, height = 5, units = 'in', res = 300)
ComplexHeatmap::draw(hm, annotation_legend_list = c(lgd), row_split = groups, merge_legend = T, heatmap_legend_side = 'left', )
dev.off()
fairePeaks.wt.test %>%
dataframe() %>%
#peaks %>%
# dplyr::filter(assay == 'faire' & experiment == 'WT FAIRE Wing Timecourse') %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h | !WT.3LW & !WT.6h & WT.24h & !WT.44h) %>%
#  dplyr::filter(WT.3LW | WT.24h) %>%
dplyr::group_by(faireCat.3LW_24h, osa.cnr, yw.cnr) %>%
dplyr::count() %>%
na.omit() %>%
dplyr::mutate(Osa.Bound = ifelse(osa.cnr & !yw.cnr, T, F)) %>%
dplyr::ungroup() %>%
dplyr::select(faireCat.3LW_24h, Osa.Bound, n) %>%
reshape2::melt(id = c("Osa.Bound","n"), variable.name = 'stage', value.name = 'change') %>%
dplyr::group_by(stage, change, Osa.Bound) %>%
dplyr::summarise(peaks = sum(n)) %>%
dplyr::mutate(fraction = peaks / sum(peaks),
change = factor(change, levels = c('static','opening','closing'))) %>%
dplyr::mutate(per = paste0(round(100*fraction, digits = 1),'%')) %>%
plot.frac()
fairePeaks.wt.test %>%
data.frame() %>%
#peaks %>%
# dplyr::filter(assay == 'faire' & experiment == 'WT FAIRE Wing Timecourse') %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h | !WT.3LW & !WT.6h & WT.24h & !WT.44h) %>%
#  dplyr::filter(WT.3LW | WT.24h) %>%
dplyr::group_by(faireCat.3LW_24h, osa.cnr, yw.cnr) %>%
dplyr::count() %>%
na.omit() %>%
dplyr::mutate(Osa.Bound = ifelse(osa.cnr & !yw.cnr, T, F)) %>%
dplyr::ungroup() %>%
dplyr::select(faireCat.3LW_24h, Osa.Bound, n) %>%
reshape2::melt(id = c("Osa.Bound","n"), variable.name = 'stage', value.name = 'change') %>%
dplyr::group_by(stage, change, Osa.Bound) %>%
dplyr::summarise(peaks = sum(n)) %>%
dplyr::mutate(fraction = peaks / sum(peaks),
change = factor(change, levels = c('static','opening','closing'))) %>%
dplyr::mutate(per = paste0(round(100*fraction, digits = 1),'%')) %>%
plot.frac()
test <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter(faireCat.3LW_24h == 'closing' & osa.cnr & !yw.cnr & anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(!WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- test %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
ame %>%
dplyr::group_by(symbol) %>%
dplyr::filter(adj.pvalue == min(adj.pvalue) & rank %in% 1:10) %>%
dplyr::mutate(neglogP = -log10(adj.pvalue)) %>%
dplyr::ungroup() %>% # fct_reorder fails with grouped data, so annoying
dplyr::mutate(symbol = forcats::fct_reorder(symbol, neglogP)) %>%
ggplot(aes('Osa Bound', symbol, fill = neglogP)) +
geom_raster() +
scale_fill_continuous(type = 'viridis', name = '-log(adj.Pvalue)') +
theme(axis.text.y = element_text(size = 12),
axis.title = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank())
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
test <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr & anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(!WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- test %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
ame %>%
dplyr::group_by(symbol) %>%
dplyr::filter(adj.pvalue == min(adj.pvalue) & rank %in% 1:10) %>%
dplyr::mutate(neglogP = -log10(adj.pvalue)) %>%
dplyr::ungroup() %>% # fct_reorder fails with grouped data, so annoying
dplyr::mutate(symbol = forcats::fct_reorder(symbol, neglogP)) %>%
ggplot(aes('Osa Bound', symbol, fill = neglogP)) +
geom_raster() +
scale_fill_continuous(type = 'viridis', name = '-log(adj.Pvalue)') +
theme(axis.text.y = element_text(size = 12),
axis.title = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank())
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
test <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr & anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
dplyr::filter(!WT.3LW) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- test %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
ame %>%
dplyr::group_by(symbol) %>%
dplyr::filter(adj.pvalue == min(adj.pvalue) & rank %in% 1:10) %>%
dplyr::mutate(neglogP = -log10(adj.pvalue)) %>%
dplyr::ungroup() %>% # fct_reorder fails with grouped data, so annoying
dplyr::mutate(symbol = forcats::fct_reorder(symbol, neglogP)) %>%
ggplot(aes('Osa Bound', symbol, fill = neglogP)) +
geom_raster() +
scale_fill_continuous(type = 'viridis', name = '-log(adj.Pvalue)') +
theme(axis.text.y = element_text(size = 12),
axis.title = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank())
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
test <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr & anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(!WT.3LW) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- test %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
test <- osaPeaks %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr & anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(!WT.3LW) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- test %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
ame %>%
dplyr::group_by(symbol) %>%
dplyr::filter(adj.pvalue == min(adj.pvalue) & rank %in% 1:10) %>%
dplyr::mutate(neglogP = -log10(adj.pvalue)) %>%
dplyr::ungroup() %>% # fct_reorder fails with grouped data, so annoying
dplyr::mutate(symbol = forcats::fct_reorder(symbol, neglogP)) %>%
ggplot(aes('Osa Bound', symbol, fill = neglogP)) +
geom_raster() +
scale_fill_continuous(type = 'viridis', name = '-log(adj.Pvalue)') +
theme(axis.text.y = element_text(size = 12),
axis.title = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank())
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
test <- fairePeaks.wt %>%
data.frame() %>%
dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr) %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
dplyr::filter(faireCat.3LW_24h != 'opening') %>%
#dplyr::filter(!WT.3LW) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
dplyr::filter(osa.cnr & !yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- test %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
query <- fairePeaks.wt %>%
data.frame() %>%
dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr) %>%
#dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
dplyr::filter(faireCat.3LW_24h == 'static') %>%
#dplyr::filter(!WT.3LW) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
dplyr::filter(osa.cnr & !yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- query %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
ame %>%
dplyr::group_by(symbol) %>%
dplyr::filter(adj.pvalue == min(adj.pvalue) & rank %in% 1:10) %>%
dplyr::mutate(neglogP = -log10(adj.pvalue)) %>%
dplyr::ungroup() %>% # fct_reorder fails with grouped data, so annoying
dplyr::mutate(symbol = forcats::fct_reorder(symbol, neglogP)) %>%
ggplot(aes('Osa Bound', symbol, fill = neglogP)) +
geom_raster() +
scale_fill_continuous(type = 'viridis', name = '-log(adj.Pvalue)') +
theme(axis.text.y = element_text(size = 12),
axis.title = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank())
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
query <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'static') %>%
#dplyr::filter(!WT.3LW) %>%
dplyr::filter(WT.3LW $ WT.24h | !WT.3LW & !WT.24h) %>%
#dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
#dplyr::filter(osa.cnr & !yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
query <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'static') %>%
#dplyr::filter(!WT.3LW) %>%
dplyr::filter(WT.3LW & WT.24h | !WT.3LW & !WT.24h) %>%
#dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
#dplyr::filter(osa.cnr & !yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- query %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
ame %>%
dplyr::group_by(symbol) %>%
dplyr::filter(adj.pvalue == min(adj.pvalue) & rank %in% 1:10) %>%
dplyr::mutate(neglogP = -log10(adj.pvalue)) %>%
dplyr::ungroup() %>% # fct_reorder fails with grouped data, so annoying
dplyr::mutate(symbol = forcats::fct_reorder(symbol, neglogP)) %>%
ggplot(aes('Osa Bound', symbol, fill = neglogP)) +
geom_raster() +
scale_fill_continuous(type = 'viridis', name = '-log(adj.Pvalue)') +
theme(axis.text.y = element_text(size = 12),
axis.title = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank())
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
query <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h & !WT.44h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'static') %>%
#dplyr::filter(!WT.3LW) %>%
dplyr::filter(WT.3LW & WT.24h | !WT.3LW & !WT.24h) %>%
#dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
dplyr::filter(osa.cnr & !yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- query %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
query <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr) %>%
dplyr::filter(WT.3LW & !WT.24h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'static') %>%
#dplyr::filter(!WT.3LW) %>%
dplyr::filter(WT.3LW & WT.24h | !WT.3LW & !WT.24h) %>%
#dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
dplyr::filter(osa.cnr & !yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- query %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
query <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'closing' & anno.new %in% c('Distal Intergenic','Intron')) %>%
dplyr::filter( osa.cnr & !yw.cnr) %>%
dplyr::filter(WT.3LW & !WT.6h & !WT.24h) %>%
#dplyr::filter(WT.3LW | WT.6h | WT.24h | WT.44h) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
control <- fairePeaks.wt %>%
data.frame() %>%
#dplyr::filter(faireCat.3LW_24h == 'static') %>%
#dplyr::filter(!WT.3LW) %>%
dplyr::filter(WT.3LW & WT.24h) %>%
#dplyr::filter(anno.new %in% c('Distal Intergenic', 'Intron')) %>%
#dplyr::filter(!osa.cnr | osa.cnr & yw.cnr) %>%
dplyr::filter(osa.cnr & !yw.cnr) %>%
GRanges() %>%
resize(250, "center") %>%
memes::get_sequence(dm6)
ame <- query %>%
memes::runAme(control = control) %>%
dplyr::group_by(motif_alt_id) %>%
dplyr::mutate(symbol = stringr::str_split_fixed(motif_alt_id, '_|-', n = 2)[[1]])
ame %>%
dplyr::group_by(symbol) %>%
dplyr::filter(adj.pvalue == min(adj.pvalue) & rank %in% 1:10) %>%
dplyr::mutate(neglogP = -log10(adj.pvalue)) %>%
dplyr::ungroup() %>% # fct_reorder fails with grouped data, so annoying
dplyr::mutate(symbol = forcats::fct_reorder(symbol, neglogP)) %>%
ggplot(aes('Osa Bound', symbol, fill = neglogP)) +
geom_raster() +
scale_fill_continuous(type = 'viridis', name = '-log(adj.Pvalue)') +
theme(axis.text.y = element_text(size = 12),
axis.title = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank())
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
fairePeaks.wt %>%
data.frame() %>%
ggplot(aes(faire_3LW_24h.log2FoldChange, faire_3LW_24h.padj, color = faireCat.3LW_24h)) +
geom_point*
#ggsave('rPlots/3E_osaBound.png', width = 3, height = 4, dpi = 300)
```
fairePeaks.wt %>%
data.frame() %>%
ggplot(aes(faire_3LW_24h.log2FoldChange, faire_3LW_24h.padj, color = faireCat.3LW_24h)) +
geom_point()
