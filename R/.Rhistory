geom_ribbon(aes(ymin = mean - sd, ymax = mean + sd), alpha = 0.3) +
geom_line() +
#  geom_text(data = plot.df, aes(label = paste0('n=',n,' (',per,')'), x = 4, y = 2), size = 6) +
scale_fill_manual(values = c('#d9435e','grey60','#69d943')) +
facet_wrap(~title, ncol = 1)
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = paste0(group,' n=',n,' (',per,')'),
group = factor(group, levels = c('UP','STATIC','DOWN')),
title = factor(title),
title = forcats::fct_reorder(title, group))
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = paste0(group,' n=',n,' (',per,')'),
group = factor(group, levels = c('UP','STATIC','DOWN')),
title = factor(title),
title = forcats::fct_reorder(.f = title, .x = group))
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = paste0(group,' n=',n,' (',per,')'),
group = factor(group, levels = c('UP','STATIC','DOWN')),
title = factor(title)) %>%
dplyr::ungroup() %>%
dplyr::mutate(title = forcats::fct_reorder(.f = title, .x = group))
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = factor(group, levels = c('UP','STATIC','DOWN')),
title = paste0(title,' n=',n,' (',per,')'))
plot.df %>%
ggplot(aes(stage, mean, group = group, fill = group)) +
geom_ribbon(aes(ymin = mean - sd, ymax = mean + sd), alpha = 0.3) +
geom_line() +
#  geom_text(data = plot.df, aes(label = paste0('n=',n,' (',per,')'), x = 4, y = 2), size = 6) +
scale_fill_manual(values = c('#d9435e','grey60','#69d943')) +
facet_wrap(~title, ncol = 1)
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = factor(group, levels = c('DOWN','STATIC','UP')),
title = paste0(title,' n=',n,' (',per,')'))
plot.df %>%
ggplot(aes(stage, mean, group = group, fill = group)) +
geom_ribbon(aes(ymin = mean - sd, ymax = mean + sd), alpha = 0.3) +
geom_line() +
#  geom_text(data = plot.df, aes(label = paste0('n=',n,' (',per,')'), x = 4, y = 2), size = 6) +
scale_fill_manual(values = c('#d9435e','grey60','#69d943')) +
facet_wrap(~title, ncol = 1)
plot.df$title
typeof(plot.df$title)
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = paste0(title,' n=',n,' (',per,')'),
title = factor(group, levels = c('UP n=207 (62%)',
'STATIC n=124 (37.1%)',
'DOWN n=3 (0.9%)')))
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = paste0(title,' n=',n,' (',per,')'))
plot.df <- dds.df %>%
dplyr::select(peak, k, dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
tidyr::pivot_longer(dplyr::matches("faire.\\d{1,2}h.zScore|faire.3LW.zScore")) %>%
dplyr::mutate(stage = stringr::str_split_fixed(name,'\\.', n = 3)[,2], ) %>%
dplyr::group_by(peak, k)  %>%
dplyr::mutate(value = value + 1,
norm = log2(value/value[stage == '3LW'])) %>%
tidyr::pivot_wider(id_cols = peak, names_from = stage, values_from = norm) %>%
dplyr::mutate(group = dplyr::case_when(`24h` >= 1 | `36h` >= 1 | `44h` >= 1 ~ 'UP',
`24h` > -1 & `24h` < 1 | `36h` > -1 & `36h` < 1 | `44h` > -1 & `44h` < 1 ~ 'STATIC',
T ~ 'DOWN')) %>%
tidyr::pivot_longer(dplyr::matches("\\d"), names_to = 'stage') %>%
dplyr::mutate(stage = factor(stage, levels = c('3LW', '6h', '18h','24h','36h','44h'))) %>%
dplyr::group_by(group,stage) %>%
dplyr::summarise(mean = mean(value),
sd = sd(value) ,
n = dplyr::n()) %>%
dplyr::group_by(stage) %>%
dplyr::mutate(frac = n/sum(n),
per = paste0(round(frac*100,1),'%'),
title = paste0(group,' n=',n,' (',per,')'),
title = factor(title, levels = c('UP n=207 (62%)',
'STATIC n=124 (37.1%)',
'DOWN n=3 (0.9%)')))
plot.df %>%
ggplot(aes(stage, mean, group = group, fill = group)) +
geom_ribbon(aes(ymin = mean - sd, ymax = mean + sd), alpha = 0.3) +
geom_line() +
#  geom_text(data = plot.df, aes(label = paste0('n=',n,' (',per,')'), x = 4, y = 2), size = 6) +
scale_fill_manual(values = c('#d9435e','grey60','#69d943')) +
facet_wrap(~title, ncol = 1)
#  theme(#strip.background = element_blank(),
#        strip.text = element_text(name = 'butt')) +
NULL
ggsave('rPlots/4-draft-osaDep-cluster.png', width = 4, height = 5 , dpi = 300)
ggsave('rPlots/4-draft-osaDep-cluster.png', width = 3, height = 4 , dpi = 300)
plot.df %>%
ggplot(aes(stage, mean, group = group, fill = group)) +
geom_ribbon(aes(ymin = mean - sd, ymax = mean + sd), alpha = 0.3) +
geom_line() +
#  geom_text(data = plot.df, aes(label = paste0('n=',n,' (',per,')'), x = 4, y = 2), size = 6) +
scale_fill_manual(values = c('#d9435e','grey60','#69d943')) +
facet_wrap(~title, ncol = 1) +
theme(legend.position = 'none') +
NULL
ggsave('rPlots/4-draft-osaDep-cluster.png', width = 2, height = 4 , dpi = 300)
plot.df %>%
ggplot(aes(stage, mean, group = group)) +
geom_ribbon(aes(ymin = mean - sd, ymax = mean + sd), alpha = 0.5) +
geom_line() +
#  geom_text(data = plot.df, aes(label = paste0('n=',n,' (',per,')'), x = 4, y = 2), size = 6) +
# scale_fill_manual(values = c('#d9435e','grey60','#69d943')) +
facet_wrap(~title, ncol = 1) +
theme(legend.position = 'none') +
NULL
ggsave('rPlots/4-draft-osaDep-cluster.png', width = 2, height = 4 , dpi = 300)
plot.df %>%
ggplot(aes(stage, mean, group = group)) +
geom_ribbon(aes(ymin = mean - sd, ymax = mean + sd), alpha = 0.4) +
geom_line() +
#  geom_text(data = plot.df, aes(label = paste0('n=',n,' (',per,')'), x = 4, y = 2), size = 6) +
# scale_fill_manual(values = c('#d9435e','grey60','#69d943')) +
facet_wrap(~title, ncol = 1) +
theme(legend.position = 'none') +
NULL
ggsave('rPlots/4-draft-osaDep-cluster.png', width = 2, height = 4 , dpi = 300)
wing.rnaseq %>%
dplyr::select(-log_mean,-mean) %>%
tidyr::pivot_longer(!Geneid) %>%
dplyr::filter(Geneid %in% c('FBgn0000567',
'FBgn0003090',)) %>%
#'FBgn0004865',
#'FBgn0264490')) %>%
dplyr::group_by(name) %>%
dplyr::mutate(name = stringr::str_remove(name,'X'),
grp = stringr::str_split_fixed(name,'_',n=2)[[1]],
grp = factor(grp, levels = c('L3', '6h','18h','24h','36h','44h')),
Gene = dplyr::case_when(Geneid == 'FBgn0000567' ~ 'Eip74EF',
Geneid == 'FBgn0003090' ~ 'pk')) %>%
#                                        Geneid == 'FBgn0004865' ~ 'Eip78C',
#                                        Geneid == 'FBgn0264490' ~ 'Eip93F')) %>%
dplyr::group_by(Gene, grp) %>%
dplyr::summarise(mean = mean(value)) %>%
dplyr::mutate(fracmax = mean/max(mean)) %>%
ggplot(aes(grp, fracmax, color = Gene, group = Gene)) +
geom_line(size = 2) +
theme(axis.title = element_blank(),
axis.text = element_text(size = 20),
panel.grid.major = element_line(color = 'grey80'),
legend.key.size = unit(1, 'cm'),
legend.title = element_text(size = 20),
legend.text = element_text(size = 20))
wing.rnaseq %>%
dplyr::select(-log_mean,-mean) %>%
tidyr::pivot_longer(!Geneid) %>%
dplyr::filter(Geneid %in% c('FBgn0000567',
'FBgn0003090')) %>%
#'FBgn0004865',
#'FBgn0264490')) %>%
dplyr::group_by(name) %>%
dplyr::mutate(name = stringr::str_remove(name,'X'),
grp = stringr::str_split_fixed(name,'_',n=2)[[1]],
grp = factor(grp, levels = c('L3', '6h','18h','24h','36h','44h')),
Gene = dplyr::case_when(Geneid == 'FBgn0000567' ~ 'Eip74EF',
Geneid == 'FBgn0003090' ~ 'pk')) %>%
#                                        Geneid == 'FBgn0004865' ~ 'Eip78C',
#                                        Geneid == 'FBgn0264490' ~ 'Eip93F')) %>%
dplyr::group_by(Gene, grp) %>%
dplyr::summarise(mean = mean(value)) %>%
dplyr::mutate(fracmax = mean/max(mean)) %>%
ggplot(aes(grp, fracmax, color = Gene, group = Gene)) +
geom_line(size = 2) +
theme(axis.title = element_blank(),
axis.text = element_text(size = 20),
panel.grid.major = element_line(color = 'grey80'),
legend.key.size = unit(1, 'cm'),
legend.title = element_text(size = 20),
legend.text = element_text(size = 20))
ggsave('rPlots/4G-pk-e74-expression.png', width = 3, height = 3, dpi = 300)
ggsave('rPlots/4G-pk-e74-expression.png', width = 5, height = 3, dpi = 300)
wing.rnaseq %>%
dplyr::select(-log_mean,-mean) %>%
tidyr::pivot_longer(!Geneid) %>%
dplyr::filter(Geneid %in% c('FBgn0000567',
'FBgn0003090')) %>%
#'FBgn0004865',
#'FBgn0264490')) %>%
dplyr::group_by(name) %>%
dplyr::mutate(name = stringr::str_remove(name,'X'),
grp = stringr::str_split_fixed(name,'_',n=2)[[1]],
grp = factor(grp, levels = c('L3', '6h','18h','24h','36h','44h')),
Gene = dplyr::case_when(Geneid == 'FBgn0000567' ~ 'Eip74EF',
Geneid == 'FBgn0003090' ~ 'pk')) %>%
#                                        Geneid == 'FBgn0004865' ~ 'Eip78C',
#                                        Geneid == 'FBgn0264490' ~ 'Eip93F')) %>%
dplyr::group_by(Gene, grp) %>%
dplyr::summarise(mean = mean(value)) %>%
dplyr::mutate(fracmax = mean/max(mean)) %>%
ggplot(aes(grp, fracmax, color = Gene, group = Gene)) +
geom_line(size = 2) +
theme(axis.title = element_blank(),
axis.text = element_text(size = 12),
panel.grid.major = element_line(color = 'grey80'),
legend.key.size = unit(1, 'cm'),
legend.title = element_text(size = 20),
legend.text = element_text(size = 20))
ggsave('rPlots/4G-pk-e74-expression.png', width = 5, height = 3, dpi = 300)
wing.rnaseq %>%
dplyr::select(-log_mean,-mean) %>%
tidyr::pivot_longer(!Geneid) %>%
dplyr::filter(Geneid %in% c('FBgn0000567',
'FBgn0003090')) %>%
#'FBgn0004865',
#'FBgn0264490')) %>%
dplyr::group_by(name) %>%
dplyr::mutate(name = stringr::str_remove(name,'X'),
grp = stringr::str_split_fixed(name,'_',n=2)[[1]],
grp = factor(grp, levels = c('L3', '6h','18h','24h','36h','44h')),
Gene = dplyr::case_when(Geneid == 'FBgn0000567' ~ 'Eip74EF',
Geneid == 'FBgn0003090' ~ 'pk')) %>%
#                                        Geneid == 'FBgn0004865' ~ 'Eip78C',
#                                        Geneid == 'FBgn0264490' ~ 'Eip93F')) %>%
dplyr::group_by(Gene, grp) %>%
dplyr::summarise(mean = mean(value)) %>%
dplyr::mutate(fracmax = mean/max(mean)) %>%
ggplot(aes(grp, fracmax, color = Gene, group = Gene)) +
geom_line(size = 2) +
theme(axis.title = element_blank(),
axis.text = element_text(size = 12),
panel.grid.major = element_line(color = 'grey80'),
legend.key.size = unit(1, 'cm'),
legend.title = element_text(size = 12),
legend.text = element_text(size = 12))
ggsave('rPlots/4G-pk-e74-expression.png', width = 5, height = 3, dpi = 300)
ol.dep
library(magrittr)
library(ggplot2)
library(viridis)
color_scale = c("#f0e932","#03d7fc","#1fb800", "#FFFFFF", "#f059a2")
brm_complex <- c('Bap111','brm','mor','Snr1','Act5C','Bap55')
pbap_complex <- c('polybromo', 'bap170')
bap_complex <- c('osa')
ino80 <- c('Arp5','Ino80','pho','Act5C')
dom <- c('dom','Tip60','Nipped-A','pont','Reptin')
atac <- c('Atac2','Atac3','D12','Wds','NC2beta')
NURF <- c('E(bx)', 'Nurf-38','ISWI','Caf1-55')
ACF <- c('Acf','Chrac-16')
NURD <- c('Mi-2','MTA1-like','Caf1-55')
NORC <- c('CtBP','Tou')
demethyl <- c('Jarid2','lid','su(var)3-3')
control <- c('lexA')
SNF2_like = c('kis','okr','Chd1','Etl1')
nucleosome_remod <- c(brm_complex, pbap_complex, bap_complex, ino80, dom, atac, NURF, ACF, NURD, SNF2_like)
dom_complex <- c('dom','Tip60','pont', 'rept','Nipped-A','Brd8')
outdata <- read.csv('../output/resultsDF.csv') %>%
dplyr::mutate(id = paste(symbol, line, sep = "_"),
nucleosome_remodeler = ifelse(symbol %in% nucleosome_remod, T, F),
Negcontrol = dplyr::case_when(symbol %in% control ~ 'Negative-Control',
T ~ 'test'),
complex_general = dplyr::case_when(symbol %in% brm_complex | symbol %in% pbap_complex | symbol %in% bap_complex ~ 'PBAP/BAP',
symbol %in% control ~ 'Negative-Control',
T ~ 'other'),
complex = dplyr::case_when(symbol %in% brm_complex ~ 'core',
symbol %in% pbap_complex ~ 'pbap',
symbol %in% bap_complex ~ 'bap',
symbol %in% control ~ 'Negative-Control',
T ~ 'other'),
other_complex = dplyr::case_when(symbol %in% brm_complex ~ '(p)bap',
symbol %in% pbap_complex ~ 'pbap',
symbol %in% bap_complex ~ 'bap',
symbol %in% control ~ 'Negative-Control',
symbol %in% ino80 ~ 'Ino80',
symbol %in% dom ~ 'Domino',
symbol %in% atac ~ 'ATAC',
symbol %in% NURF ~ 'NURF',
symbol %in% ACF ~ 'ACF',
symbol %in% NURD ~ 'NURD',
symbol %in% NORC ~ 'NORC',
symbol %in% demethyl ~ 'Demethylase',
T ~ 'other')) %>%
dplyr::filter(stack >= 10 & gfp >= 8 & size == "1024x1024") %>%
dplyr::group_by(id) %>%
dplyr::mutate(log2 = log2(KDtoWT),
mean_ratio = median(KDtoWT),
meanlog2 = mean(log2), # changing from filter on mean_log2...
bap_hits = dplyr::case_when(mean_ratio >= 1.2 & complex_general == 'PBAP/BAP' ~ 'Brahma Complex', #increase of atleast 150%
complex_general == 'Negative-Control' ~ 'Negative-Control',
T ~ 'other'))
nr <- outdata %>% dplyr::filter(nucleosome_remodeler | Negcontrol == 'Negative-Control')
lines <- length(unique(outdata$line))
genes <- length(unique(outdata$symbol))
complexes <- length(unique(outdata$other_complex))
#average number of wings per line
outdata %>%
dplyr::group_by(symbol, line) %>%
dplyr::count(line) %>%
dplyr::ungroup() %>%
dplyr::summarise(mean = mean(n))
#write csv with just the tested lines for reference
write.table(unique(outdata$line), "r_out/tested-lines.csv", quote = F, col.names = F, row.names = F, sep = ',')
#unique(outdata$line)
less_than_4_wings <- outdata %>%
dplyr::group_by(symbol, line) %>%
dplyr::count(line) %>%
dplyr::arrange(n) %>%
dplyr::filter(n <= 4)
write.table(less_than_4_wings, "r_out/lines_with_less_than_4_wings.csv", row.names = F, quote = F,sep = ',')
summary_df <- data.frame('Lines' = lines,
'Genes' = genes,
'Complexes' = complexes)
summary_grob <- gridExtra::tableGrob(summary_df, rows = NULL, )
h = grid::convertHeight(sum(summary_grob$heights), "in", T)
w = grid::convertHeight(sum(summary_grob$widths), "in", T)
ggplot2::ggsave("r_out/summary_table.pdf", summary_grob, width = w, height = h)
#outdata %>%
#  dplyr::filter(stack >= 10 & gfp >= 8 & size == "1024x1024") %>%
#  dplyr::group_by(symbol, line) %>%
#  dplyr::mutate(med = median(KDtoWT)) %>%
#  ggplot(aes(forcats::fct_reorder(id, KDtoWT), KDtoWT)) +
#  geom_hline(yintercept = 1, color = "grey50") +
#  geom_boxplot(aes(fill = Negcontrol), outlier.shape = NA) +
#  scale_y_continuous(trans = "log2") +
#  scale_fill_manual(values = c('#1fb800','white')) +
#  ylab("log2 (brDisc KD/WT)") +
#  annotation_custom(summary_grob, xmin = 0, xmax = 20, ymin = 5, ymax = 0) +
#  theme(axis.text.x = element_text(size = 10, angle = 90, hjust = 1, vjust = 0.5),
#        axis.title.x = element_blank(),
#        panel.background = element_rect(fill = 'white', colour = 'grey10'),
#        panel.grid.major  = element_line(color = 'grey90'),
#        legend.title = element_blank())
#
#ggsave('r_out/kd_wt-brmComplex-horizontal-plot-BLANK.png', width = 11, height = 5)
nr %>%
#ggplot(aes(log2, forcats::fct_reorder(id, log2) )) +
ggplot(aes(KDtoWT, forcats::fct_reorder(id, KDtoWT) )) +
geom_vline(xintercept = 1, color = "grey50") +
geom_vline(xintercept = 1.2, color = "grey50", linetype = "longdash") + # somewhat arbitrary cutoff - based on visually confirmed hits
geom_boxplot(aes(fill = bap_hits), outlier.size = 0.5) +
scale_fill_manual(values = c("#66C2A6",'#F059A2','white')) +
scale_x_continuous(trans = "log2") + # trying out a log transformation rather than using the log2 FC data
xlab("brD KD/WT (log2 trans)") +
theme(axis.text.y = element_text(size = 10, ),
axis.title.y = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'grey10'),
panel.grid.major  = element_line(color = 'grey90'),
legend.title = element_blank(),
legend.position = 'bottom')
ggsave('r_out/kd_wt-brmComplex-horizontal-plot-GENERAL.png', width = 5, height = 8)
#nr %>%
#  dplyr::filter(stack >= 10 & gfp >= 8 & size == "1024x1024") %>%
#  dplyr::group_by(symbol, line) %>%
#  dplyr::mutate(med = median(KDtoWT)) %>%
#  #ggplot(aes(forcats::fct_reorder(id, KDtoWT), KDtoWT)) +
#  ggplot(aes(KDtoWT, forcats::fct_reorder(id, KDtoWT))) +
#  geom_vline(xintercept = 1, color = "grey50") +
#  #geom_boxplot(aes(fill = complex_general), outlier.shape = NA) +
#  geom_boxplot(aes(fill = bap_hits), outlier.shape = NA) +
#  scale_x_continuous(trans = "log2") +
#  scale_fill_manual(values = c("#66C2A6",'#F059A2','white')) +
#  xlab("log2 (brDisc KD/WT)") +
#  #annotation_custom(summary_grob, xmin = 0, xmax = 20, ymin = 5, ymax = 0) +
#  theme(axis.title.y = element_blank(),
#        panel.background = element_rect(fill = 'white', colour = 'grey10'),
#        panel.grid.major  = element_line(color = 'grey90'),
#        legend.title = element_blank(),
#        legend.position = 'bottom',
#        legend.key.size = unit(0.5, 'cm'))
#  NULL
#ggsave('r_out/kd_wt-brmComplex-vertical-plot-GENERAL.png', width = 5, height =7)
#outdata %>%
#  dplyr::filter(stack >= 10 & gfp >= 8 & size == "1024x1024") %>%
#  dplyr::group_by(symbol, line) %>%
#  dplyr::mutate(med = median(KDtoWT)) %>%
#  ggplot(aes(forcats::fct_reorder(id, KDtoWT), KDtoWT)) +
#  geom_hline(yintercept = 1, color = "grey50") +
#  geom_boxplot(aes(fill = complex), outlier.shape = NA) +
#  scale_y_continuous(trans = "log2") +
#  scale_fill_manual(values = color_scale) +
#  ylab("log2 (brDisc KD/WT)") +
#  annotation_custom(summary_grob, xmin = 0, xmax = 20, ymin = 5, ymax = 0) +
#  theme(axis.text.x = element_text(size = 10, angle = 90, hjust = 1, vjust = 0.5),
#        axis.title.x = element_blank(),
#        panel.background = element_rect(fill = 'white', colour = 'grey10'),
#        panel.grid.major  = element_line(color = 'grey90'), )
#
#ggsave('r_out/kd_wt-brmComplex-horizontal-plot.png', width = 11, height = 5)
nr
anno.df
enrichtest
