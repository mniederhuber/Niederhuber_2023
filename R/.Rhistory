range <- data.frame(seqnames = 'chr2R',
start = 18202429,
end = 18290126) %>%
GRanges()
#peakTrack <- Gviz::AnnotationTrack(range = osaPeaks.full, genome = 'dm6', fill = '#D01C8B', col = 'transparent', background.title = 'white', showTitle = F )
#peaks %>%
#  dplyr::filter(assay == 'faire' & experiment == 'osaGFP deGrad Pupal Wing FAIRE' & faireCat.osaDeGrad == 'Osa Dependent') %>%
#  dplyr::filter(osaGFP.deGrad | osaGFP.control) %>%
#  dplyr::arrange(desc(faire_osaDeGrad.log2FoldChange)) %>%
#  ggplot(aes(faire_osaDeGrad.pvalue, faire_osaDeGrad.log2FoldChange)) +
#  geom_point()
#  dplyr::select(seqnames, start, end) %>%
#  write.table(., file = '~/Desktop/osaDep.bed', col.names = F, row.names = F, quote = F)
# chr2R:11,465,947-11,499,493
#track.colors <- RColorBrewer::brewer.pal(n = 4, "PiYG")
track.colors <- c("#50c42d","#469ae8","grey70","grey60","grey50")
deg.ss.browser <- faire.osaDeGrad.ssPool %>%
dplyr::bind_rows(., faire.wt.ssPool[faire.wt.ssPool$grp == 'wt.3LW' | faire.wt.ssPool$grp == 'wt.24h' | faire.wt.ssPool$grp == 'wt.44h',]) %>%
dplyr::mutate(color = track.colors)
cnr.tracks <- get_cnr_tracks(cnr.ss.browser, ylim = c(0,20))
cnr.tracks <- list(cnr.tracks$osaGFP.rep1, cnr.tracks$osaGFP.rep2, peakTrack, cnr.tracks$yw.rep1, cnr.tracks$yw.rep2)
spacer <- Gviz::AnnotationTrack(background.title = 'white')
deg.tracks <- get_cnr_tracks(deg.ss.browser, ylim = c(0,13))
deg.tracks <- c(cnr.tracks, # add in osa cnr tracks with peaks
spacer,
deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
spacer,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
#brdisc.at <- Gviz::AnnotationTrack(range = inv, genome = 'dm6', name = 'brDisc', fill = 'grey', col = 'transparent', background.title = 'white', showTitle = F )
axis <- Gviz::GenomeAxisTrack(scale = 10000)
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range),
to = end(range),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
deg.tracks <- c(cnr.tracks, # add in osa cnr tracks with peaks
spacer,
spacer,
spacer,
deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
spacer,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
#TODO - add highlights for dependent regions - currently manually annotating in illustrator
dds.track <- Gviz::AnnotationTrack(range = GRanges(dds.dep), genome = 'dm6', fill = '#469ae8', col = 'transparent', background.title = 'white', showTitle = F)
#chr2L:6,166,371-6,170,699 -
#chr2R:18,244,125-18,248,497
range <- data.frame(seqnames = 'chr2R',
start = 18202429,
end = 18290126) %>%
GRanges()
#peakTrack <- Gviz::AnnotationTrack(range = osaPeaks.full, genome = 'dm6', fill = '#D01C8B', col = 'transparent', background.title = 'white', showTitle = F )
#peaks %>%
#  dplyr::filter(assay == 'faire' & experiment == 'osaGFP deGrad Pupal Wing FAIRE' & faireCat.osaDeGrad == 'Osa Dependent') %>%
#  dplyr::filter(osaGFP.deGrad | osaGFP.control) %>%
#  dplyr::arrange(desc(faire_osaDeGrad.log2FoldChange)) %>%
#  ggplot(aes(faire_osaDeGrad.pvalue, faire_osaDeGrad.log2FoldChange)) +
#  geom_point()
#  dplyr::select(seqnames, start, end) %>%
#  write.table(., file = '~/Desktop/osaDep.bed', col.names = F, row.names = F, quote = F)
# chr2R:11,465,947-11,499,493
#track.colors <- RColorBrewer::brewer.pal(n = 4, "PiYG")
track.colors <- c("#50c42d","#469ae8","grey70","grey60","grey50")
deg.ss.browser <- faire.osaDeGrad.ssPool %>%
dplyr::bind_rows(., faire.wt.ssPool[faire.wt.ssPool$grp == 'wt.3LW' | faire.wt.ssPool$grp == 'wt.24h' | faire.wt.ssPool$grp == 'wt.44h',]) %>%
dplyr::mutate(color = track.colors)
cnr.tracks <- get_cnr_tracks(cnr.ss.browser, ylim = c(0,20))
cnr.tracks <- list(cnr.tracks$osaGFP.rep1, cnr.tracks$osaGFP.rep2, peakTrack, cnr.tracks$yw.rep1, cnr.tracks$yw.rep2)
spacer <- Gviz::AnnotationTrack(background.title = 'white')
deg.tracks <- get_cnr_tracks(deg.ss.browser, ylim = c(0,13))
deg.tracks <- c(cnr.tracks, # add in osa cnr tracks with peaks
spacer,
spacer,
spacer,
deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
spacer,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
#brdisc.at <- Gviz::AnnotationTrack(range = inv, genome = 'dm6', name = 'brDisc', fill = 'grey', col = 'transparent', background.title = 'white', showTitle = F )
axis <- Gviz::GenomeAxisTrack(scale = 10000)
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range),
to = end(range),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-10e6),
to = end(range),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-10000),
to = end(range),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-10000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-15000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
deg.tracks <- c(cnr.tracks, # add in osa cnr tracks with peaks
spacer,
spacer,
spacer,
deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
deg.tracks <- c(cnr.tracks, # add in osa cnr tracks with peaks
spacer,
spacer,
spacer,
deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
#TODO - add highlights for dependent regions - currently manually annotating in illustrator
dds.track <- Gviz::AnnotationTrack(range = GRanges(dds.dep), genome = 'dm6', fill = '#469ae8', col = 'transparent', background.title = 'white', showTitle = F)
#chr2L:6,166,371-6,170,699 -
#chr2R:18,244,125-18,248,497
range <- data.frame(seqnames = 'chr2R',
start = 18202429,
end = 18290126) %>%
GRanges()
#peakTrack <- Gviz::AnnotationTrack(range = osaPeaks.full, genome = 'dm6', fill = '#D01C8B', col = 'transparent', background.title = 'white', showTitle = F )
#peaks %>%
#  dplyr::filter(assay == 'faire' & experiment == 'osaGFP deGrad Pupal Wing FAIRE' & faireCat.osaDeGrad == 'Osa Dependent') %>%
#  dplyr::filter(osaGFP.deGrad | osaGFP.control) %>%
#  dplyr::arrange(desc(faire_osaDeGrad.log2FoldChange)) %>%
#  ggplot(aes(faire_osaDeGrad.pvalue, faire_osaDeGrad.log2FoldChange)) +
#  geom_point()
#  dplyr::select(seqnames, start, end) %>%
#  write.table(., file = '~/Desktop/osaDep.bed', col.names = F, row.names = F, quote = F)
# chr2R:11,465,947-11,499,493
#track.colors <- RColorBrewer::brewer.pal(n = 4, "PiYG")
track.colors <- c("#50c42d","#469ae8","grey70","grey60","grey50")
deg.ss.browser <- faire.osaDeGrad.ssPool %>%
dplyr::bind_rows(., faire.wt.ssPool[faire.wt.ssPool$grp == 'wt.3LW' | faire.wt.ssPool$grp == 'wt.24h' | faire.wt.ssPool$grp == 'wt.44h',]) %>%
dplyr::mutate(color = track.colors)
cnr.tracks <- get_cnr_tracks(cnr.ss.browser, ylim = c(0,20))
cnr.tracks <- list(cnr.tracks$osaGFP.rep1, cnr.tracks$osaGFP.rep2, peakTrack, cnr.tracks$yw.rep1, cnr.tracks$yw.rep2)
spacer <- Gviz::AnnotationTrack(background.title = 'white')
deg.tracks <- get_cnr_tracks(deg.ss.browser, ylim = c(0,13))
deg.tracks <- c(cnr.tracks, # add in osa cnr tracks with peaks
spacer,
spacer,
spacer,
deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
#brdisc.at <- Gviz::AnnotationTrack(range = inv, genome = 'dm6', name = 'brDisc', fill = 'grey', col = 'transparent', background.title = 'white', showTitle = F )
axis <- Gviz::GenomeAxisTrack(scale = 10000)
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, dds.track, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
Gviz::plotTracks(c(axis, deg.tracks, dds.track,spacer,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, dds.track,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, spacer, spacer, dds.track,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-14000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
Gviz::plotTracks(c(axis, deg.tracks, spacer, spacer, dds.track,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-12000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
Gviz::plotTracks(c(axis, deg.tracks, spacer, spacer, dds.track,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-10000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
png('rPlots/4E-browser.png', width = 10, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, spacer, spacer, dds.track,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-10000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
png('rPlots/4E-browser.png', width = 12, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, spacer, spacer, dds.track,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-10000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
png('rPlots/4E-browser.png', width = 12, height = 5, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, spacer, spacer, dds.track,spacer,spacer, genetrack), chromosome = seqnames(range) %>% as.character(),
from = start(range-15000),
to = end(range-10000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
#TODO - add 36h FAIRE data? better comparison for osa deGrad?
#track.colors <- RColorBrewer::brewer.pal(n = 4, "PiYG")
track.colors <- c("#50c42d","#c42d85","grey70","grey60","grey50")
deg.ss.browser <- faire.osaDeGrad.ssPool %>%
dplyr::bind_rows(., faire.wt.ssPool[faire.wt.ssPool$grp == 'wt.3LW' | faire.wt.ssPool$grp == 'wt.24h' | faire.wt.ssPool$grp == 'wt.44h',]) %>%
dplyr::mutate(color = track.colors)
deg.tracks <- get_cnr_tracks(deg.ss.browser, ylim = c(0,15))
deg.tracks <- c(deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
brdisc.at <- Gviz::AnnotationTrack(range = brD, genome = 'dm6', name = 'brDisc', fill = 'grey', col = 'transparent', background.title = 'white', showTitle = F )
axis <- Gviz::GenomeAxisTrack(scale = 1000)
png('rPlots/4D.png', width = 4, height = 6, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks, brdisc.at), chromosome = seqnames(brD) %>% as.character(),
from = start(brD + 1000),
to = end(brD + 1000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
#TODO - add 36h FAIRE data? better comparison for osa deGrad?
#track.colors <- RColorBrewer::brewer.pal(n = 4, "PiYG")
track.colors <- c("#50c42d","#469ae8","grey70","grey60","grey50")
deg.ss.browser <- faire.osaDeGrad.ssPool %>%
dplyr::bind_rows(., faire.wt.ssPool[faire.wt.ssPool$grp == 'wt.3LW' | faire.wt.ssPool$grp == 'wt.24h' | faire.wt.ssPool$grp == 'wt.44h',]) %>%
dplyr::mutate(color = track.colors)
deg.tracks <- get_cnr_tracks(deg.ss.browser, ylim = c(0,15))
deg.tracks <- c(deg.tracks$wt_3LW,
deg.tracks$wt_24h,
deg.tracks$wt_44h,
deg.tracks$osaGFP.deGrad_control_faire,
deg.tracks$osaGFP.deGrad_nubG4_faire)
brdisc.at <- Gviz::AnnotationTrack(range = brD, genome = 'dm6', name = 'brDisc', fill = 'grey', col = 'transparent', background.title = 'white', showTitle = F )
axis <- Gviz::GenomeAxisTrack(scale = 1000)
png('rPlots/4D.png', width = 4, height = 6, res = 300, units = 'in')
Gviz::plotTracks(c(axis, deg.tracks,spacer,spacer, brdisc.at), chromosome = seqnames(brD) %>% as.character(),
from = start(brD + 1000),
to = end(brD + 1000),
cex.axis = 0.3,
cex.title = 0.5,
title.width = 1,
innerMargin = 10)
dev.off()
#TODO - are heatmaps misleading? is this difficult to parse when split by these different peak call groups?
cols <- c('black', '"#469ae8')
# union osa degrad peaks
deg.mats <- purrr::map(deg.bws, ~{
normalizeToMatrix(., fairePeaks.deg, value_column = 'score', keep = c(0.11,0.99), extend = 1000 )
})
names(deg.mats) <- faire.ss %>%
dplyr::filter(experiment == 'osaGFP deGrad FAIRE') %>%
dplyr::mutate(nm = paste0(stringr::str_split_fixed(id,'_|\\.', n = 5)[,3],
'.',
stringr::str_split_fixed(id,'_|\\.', n = 5)[,5])) %>%
.$nm
common_min = min(unlist(deg.mats))
common_max = max(unlist(deg.mats))
col_fun = circlize::colorRamp2(seq(common_min, common_max, length.out = 6), viridis.hex)
deg.count <- fairePeaks.deg %>%
data.frame() %>%
dplyr::group_by(faireCat.osaDeGrad) %>% #peak category assigned in peaks.R
dplyr::tally() %>%
.$n
names(deg.count) <- c('Osa Dependent', 'Osa Ectopic', 'Osa Independent')
groups <- fairePeaks.deg$faireCat.osaDeGrad
lgd = Legend(at = c("Osa Dependent", "Osa Ectopic", "Osa Independent"), legend_gp = gpar(fill = cols))
deg.hms <- purrr::map(names(deg.mats), function(x) {
if(grepl('control.Rep1',x)){
EnrichedHeatmap(deg.mats[[x]],
axis_name = c(-1000, 0, 1000),
pos_line = F,
column_title = x,
col = col_fun,
name = 'zScore',
row_title = NULL,
top_annotation = HeatmapAnnotation(enriched = anno_enriched(gp = gpar(col = cols, lwd = 2), axis_param = list(side = 'left', facing = 'outside'), ylim = c(0,8))),
left_annotation = rowAnnotation(textbox = anno_textbox(align_to = groups,
as.list(deg.count),
side = 'left',
background_gp = gpar(fill = NA, col = NA),
gp = gpar(col = 'black'),
padding = unit(0, 'mm')),
groups = anno_block(gp = gpar(fill = 2:4), show_name = F)),
use_raster = F)
}else{
EnrichedHeatmap(deg.mats[[x]],
axis_name = c(-1000, 0, 1000),
pos_line = F,
column_title = x,
col = col_fun,
show_heatmap_legend = F,
row_title = NULL,
top_annotation = HeatmapAnnotation(enriched = anno_enriched(gp = gpar(col = cols, lwd = 2), ylim = c(0,8), axis = F)),
use_raster = F)
}
})
names(deg.hms) <- names(deg.mats)
hms <- deg.hms$control.Rep1 + deg.hms$control.Rep2 + deg.hms$nubG4.Rep1 + deg.hms$nubG4.Rep2
png('rPlots/4B.png', width = 5, height = 5, units = 'in', res = 300)
ComplexHeatmap::draw(hms,annotation_legend_list = c(lgd), row_split = groups, merge_legend = T, heatmap_legend_side = 'bottom', )
cols <- c('black', '#469ae8')
deg.hms <- purrr::map(names(deg.mats), function(x) {
if(grepl('control.Rep1',x)){
EnrichedHeatmap(deg.mats[[x]],
axis_name = c(-1000, 0, 1000),
pos_line = F,
column_title = x,
col = col_fun,
name = 'zScore',
row_title = NULL,
top_annotation = HeatmapAnnotation(enriched = anno_enriched(gp = gpar(col = cols, lwd = 2), axis_param = list(side = 'left', facing = 'outside'), ylim = c(0,8))),
left_annotation = rowAnnotation(textbox = anno_textbox(align_to = groups,
as.list(deg.count),
side = 'left',
background_gp = gpar(fill = NA, col = NA),
gp = gpar(col = 'black'),
padding = unit(0, 'mm')),
groups = anno_block(gp = gpar(fill = 2:4), show_name = F)),
use_raster = F)
}else{
EnrichedHeatmap(deg.mats[[x]],
axis_name = c(-1000, 0, 1000),
pos_line = F,
column_title = x,
col = col_fun,
show_heatmap_legend = F,
row_title = NULL,
top_annotation = HeatmapAnnotation(enriched = anno_enriched(gp = gpar(col = cols, lwd = 2), ylim = c(0,8), axis = F)),
use_raster = F)
}
})
lgd = Legend(at = c("Osa Dependent", "Osa Ectopic", "Osa Independent"), legend_gp = gpar(fill = cols))
names(deg.hms) <- names(deg.mats)
hms <- deg.hms$control.Rep1 + deg.hms$control.Rep2 + deg.hms$nubG4.Rep1 + deg.hms$nubG4.Rep2
png('rPlots/4B.png', width = 5, height = 5, units = 'in', res = 300)
ComplexHeatmap::draw(hms,annotation_legend_list = c(lgd), row_split = groups, merge_legend = T, heatmap_legend_side = 'bottom', )
dev.off()
cols <- c('black', '#469ae8')
deg.mats <- purrr::map(deg.bws, ~{
normalizeToMatrix(., GRanges(dds.peaks.qF), value_column = 'score', keep = c(0.11,0.99), extend = 1000 )
})
names(deg.mats) <- faire.ss %>%
dplyr::filter(experiment == 'osaGFP deGrad FAIRE') %>%
dplyr::mutate(nm = paste0(stringr::str_split_fixed(id,'_|\\.', n = 5)[,3],
'.',
stringr::str_split_fixed(id,'_|\\.', n = 5)[,5])) %>%
.$nm
common_min = min(unlist(deg.mats))
common_max = max(unlist(deg.mats))
col_fun = circlize::colorRamp2(seq(common_min, common_max, length.out = 6), viridis.hex)
deg.count <- dds.peaks.qF %>%
data.frame() %>%
dplyr::group_by(group) %>% #peak category assigned in peaks.R
dplyr::tally() %>%
.$n
names(deg.count) <- c('Independent', 'Osa Dependent')
groups <- dds.peaks.qF$group
lgd = Legend(at = c("Osa Independent", "Osa Dependent"), legend_gp = gpar(fill = cols))
deg.hms <- purrr::map(names(deg.mats), function(x) {
if(grepl('control.Rep1',x)){
EnrichedHeatmap(deg.mats[[x]],
axis_name = c(-1000, 0, 1000),
pos_line = F,
column_title = x,
col = col_fun,
name = 'zScore',
row_title = NULL,
top_annotation = HeatmapAnnotation(enriched = anno_enriched(gp = gpar(col = cols, lwd = 2), axis_param = list(side = 'left', facing = 'outside'), ylim = c(0,6.5))),
left_annotation = rowAnnotation(textbox = anno_textbox(align_to = groups,
as.list(deg.count),
side = 'left',
background_gp = gpar(fill = NA, col = NA),
gp = gpar(col = 'black'),
padding = unit(0, 'mm'))),
use_raster = F)
}else{
EnrichedHeatmap(deg.mats[[x]],
axis_name = c(-1000, 0, 1000),
pos_line = F,
column_title = x,
col = col_fun,
show_heatmap_legend = F,
row_title = NULL,
top_annotation = HeatmapAnnotation(enriched = anno_enriched(gp = gpar(col = cols, lwd = 2), ylim = c(0,6.5), axis = F)),
use_raster = F)
}
})
names(deg.hms) <- names(deg.mats)
hms <- deg.hms$control.Rep1 + deg.hms$control.Rep2 + deg.hms$nubG4.Rep1 + deg.hms$nubG4.Rep2
png('rPlots/4B-draft.png', width = 4.5, height = 4, units = 'in', res = 300)
ComplexHeatmap::draw(hms,annotation_legend_list = c(lgd), row_split = groups,  merge_legend = T, heatmap_legend_side = 'right', )
dev.off()
library(magrittr)
library(ggplot2)
library(DESeq2)
library(edgeR)
wing.rnaseq %>% dplyr::filter(Geneid == 'FBgn0283451') %>%
reshape2::melt() %>%
dplyr::group_by(variable) %>%
dplyr::mutate(grp = stringr::str_split_fixed(variable,'_',2)[[1]],
grp = stringr::str_remove(grp, 'X'),
grp = factor(grp, levels = (c('L3','6h','18h','24h','36h','44h')))) %>%
ggplot(aes(grp, value)) +
geom_point()
